{% comment %}
Copyright 2011 Google Inc.  All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.


This is the Django template for the landing page.
{% endcomment %}
<!doctype html>
<html>
    <head>
        <title>{{ app_title }}</title>
        <link rel="stylesheet" type="text/css" href="/static/tasks_backup.css"></link>
        <script type="text/javascript" src="/static/jquery.js"></script>
        <script type="text/javascript">

            function authorise() {
                document.getElementById("authorise_button").value = "Authorising, please wait (this may take up to half a minute) ...";
                document.getElementById("authorise_button").innerHTML = "Authorising, please wait (this may take up to half a minute) ...";
                document.getElementById("authorise_button").disabled = true;
                window.location.href = "/auth";
            }

            function disableButton() {
                document.getElementById("start_backup").value = "Starting backup (this may take several minutes) ...";
                document.getElementById("start_backup").innerHTML = "Starting backup (this may take several minutes) ...";
                document.getElementById("start_backup").disabled = true;
            }
            
            // From http://stackoverflow.com/questions/6203089/stop-blob-url-from-expiring
            function setBlobstoreUrl() {
                $.get("{{ new_blobstore_url }}", function(data){
                    $("#selectFileForm").attr('action', data);
                    $("#selectFileForm").submit();
                    $("#select_file").attr('disabled', 'true');
                    $("#actionMsg").html('<span  style="font-weight: bold; font-size: larger;">Please wait, uploading file to server ...</span><br />This may take several minutes, depending on the size of your file and the speed of your connection. ');
                }); 
            }
        </script>
        <script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-30118203-1']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();

        </script>
    </head>

<body>

{% if is_authorized %}
    <div class="usertitle">
        Authorised user: {{ user_email }} <span class="logout-link">[ <a href="{{ logout_url }}">Log out</a> ]</span>
    </div>
{% endif %}

    <h2>{{ app_title }}</h2>
  
    <noscript>
        <br />
        <h3>Javascript must be enabled to use this site</h3>
        <br />
    </noscript>
    
    {% if host_msg %}
        <div class="break">
        <h3>{{ host_msg }}</h3>
        </div>
    {% endif %}

    <div class="break">
        {{ app_title }} can be used to back up Google Tasks in any of these formats;

        <ul>
            <li>Microsoft Outlook (.csv file)</li>
            <li>iCalendar (.ics file)</li>
            <li>Raw (.csv file containing all 15 Google Tasks attributes)</li>
            <li>Python data structure</li>
            <li>Remember The Milk (email)   <span class="comment"> { untested, as I don't have RTM }</span></li>
        </ul>
        {{ app_title }} can also display tasks as a single web page (e.g., suitable for printing)
    </div>
  
    {% if msg == "ACCOUNT_ERROR" %}
        <div class="break">
            <span class="take-note-larger">
                An error occurred authorizing your account.  
            </span>
            <br />
            This could be because your Google Apps account is not authorised to access this application, or
            your account is not currently in good standing with Google.  If this
            happens again, please <a href="http:/{{ url_issues_page }}">report the issue</a> so that we can try to fix it.
        </div>
    {% endif %}
    
    {% if is_authorized %}
        <div class="break">
            
            <form method="POST" action = "{{ start_backup_url }}" onsubmit="disableButton();" >
                <fieldset>
                    <legend>Export tasks</legend>
                    <table class="include-selection">
                        <tr>
                            <th colspan="2" align="left">Advanced settings <span class="take-note-smaller">(<a href="#notes">Note</a> 1)</span></th>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="include_completed" value="True" checked="checked" >
                                    &nbsp;Include completed tasks? <span class="take-note-smaller">(<a href="#notes">Note</a> 2)</span>
                                </input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="include_deleted" value="True" >
                                    &nbsp;Include deleted tasks?  <span class="take-note-smaller">(<a href="#notes">Note</a> 3, 4, 6)</span>
                                </input>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="include_hidden" value="True" >
                                    &nbsp;Include hidden tasks? <span class="take-note-smaller"> (<a href="#notes">Note</a> 5, 6)</span>
                                </input>
                            </td>
                        </tr>
                    </table>
                    <!--<div class="small-break take-note-larger">
                       Please only click once.
                    </div>-->
                    <input type="submit" value="Start backup" id="start_backup" class="big-button" ></input> 
                    <div class="instructions">
                        When you click the button to start the backup, you will be redirected to a page which will update regularly to show progress of the background process as it retrieves tasks from the Google server
                    </div>
                    <div class="instructions">
                        The amount of time taken to generate the backup depends on various factors, 
                        including server load and the total number of tasks. 
                        At a rough estimate, the system processes 50-150 tasks per second. 
                        This means that a task list with 5,000 tasks could take around 2 minutes.
                    </div>
                </fieldset>
            </form>
        </div>
        
        <form 
            id="selectFileForm" 
            action="/dummy" 
            method="POST"
            enctype="multipart/form-data">
			<fieldset>
				<legend>Import tasks from CSV file</legend>
                <div class="instructions">
                    <span class="take-note-larger">Select CSV file to upload:</span> <input type="file" id="select_file" name="file" onchange="setBlobstoreUrl();">
                    <div class="nice-gap-top" id="actionMsg">The file must be in the format produced by the {{ app_title }} "Import/Export CSV" format
                    <span class="smaller-font">(Refer to the <a href="/static/info.html#import_export_description">information page</a> for details)</span>
                    </div>
                </div>
                
                <div class="instructions">
                    When you choose a file, the contents of that file is uploaded to the server. The amount of time required to upload the file depends on the size of the file, and the uplink speed of your Internet connection. For example, a 5MB file could take up to 2 minutes to upload on a 8192/64 ADSL link. {{ app_title }} cannot show upload progress, as the upload is managed by the browser.
                </div>
                <div class="instructions">
                    Once the file has been uploaded, you will be redirected to a page which will update regularly to show progress of the background task
                    as it creates tasks from the imported data. The amount of time taken to process the imported data depends on various factors, including server load and the total number of tasks.
                </div>
                <div class="instructions">
                    When importing tasks, if the tasklist of an imported task already exists, the imported task will be added to the existing tasklist. If the tasklist does not exist, then a new tasklist will be created. <span class="italic">Note that this application cannot check for duplicate tasks!</span>
                </div>
            </fieldset>
        </form>
                    <br />
    {% else %}
        <div class="break">
            This application uses Google authentication to access your Tasks data. The permission for this application will be displayed as "{{ product_name }} - Tasks" in your list of 
            <a href="https://www.google.com/accounts/IssuedAuthSubTokens">Authorised Sites, Apps, and Services</a>, and can be revoked there at any time.
        </div>
        <button id="authorise_button" class="big-button" type="button" onclick="authorise();">Authorise</button>
    {% endif %}
 
    <div class="break">
        This application is currently in beta. 
		You are welcome to try it, but I cannot give any guarantee that data retrieved will be correct or in a usable format. 
        It is running from my personal Google Apps account, and so has quota limitations. 
    </div>
   
    {% if is_authorized %}
        <div class="break">
        </div>
        
        <div class="heading">
            <a name="notes">Notes</a>
        </div>
        <table  class="format-selection">
            <tr>
                <td class="note-heading-smaller">
                    Note 1 - 
                </td>
                <td>
                    These settings may be used when the user wishes to customise the retrieved data.
                    <br />
                    For most applications, exported data should not include deleted or hidden tasks.
                    <br />
                <span class="take-note">CAUTION:</span> The Outlook, iCalendar and RTM file formats do not support <span class="take-note">deleted</span> or <span class="take-note">hidden</span> tasks, so those programs will display deleted and/or hidden tasks as normal tasks.
                </td>
            </tr>
            <tr>
                <td class="note-heading-smaller">
                    Note 2 - 
                </td>
                <td>
                    When checked, the backup includes completed tasks. If unchecked, only incomplete (needsAction) tasks are exported.
                    <br />
                    Selecting "Include completed tasks?" is useful if you wish to retain a backup of tasks that have been completed.
                </td>
            </tr>
            <tr>
                <td class="note-heading-smaller">
                    Note 3 - 
                </td>
                <td>
                    When tasks are deleted, they are marked as Hidden and moved to the [Trash] view.
                    <br />
                    Outlook, RTM and iCal do not differentiate deleted tasks, so they will appear as normal tasks.
                </td>
            </tr>
            <tr>
                <td class="note-heading-smaller">
                    Note 4 - 
                </td>
                <td>
                    According to Google, deleted tasks stay in the Trash (deleted = True) for "some period of time" and are then auto deleted. 
					I have noticed deleted task up to six months old. 
					There does not appear to be any way to force a task to be actually deleted. 
					That is, the Trash bin cannot be emptied by the user.
                </td>
            </tr>
            <tr>
                <td class="note-heading-smaller">
                    Note 5 - 
                </td>
                <td>
                    When tasks which have been marked complete, and then [Clear completed] is clicked, 
					those tasks are marked as Completed AND Hidden. 
                    <br />
                    Outlook, RTM and iCal do not differentiate hidden tasks, so they will appear as normal tasks.
                </td>
            </tr>
            <tr>
                <td class="note-heading-smaller">
                    Note 6 - 
                </td>
                <td>
                    If checked, deleted and hidden tasks will be dimmed (grey text) in the HTML view, 
					and will include a 'hidden' or 'deleted' label.
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    Refer to the <a href="/static/info.html">information page</a> for more details on the completed, hidden and deleted properties.
                </td>
            </tr>
        </table>
        
    {% endif %}


	<div class="project-footer">
        <div class="break">
            Version {{ app_version }} ({{ upload_timestamp }})
        </div>
		<div class="break">
			Questions or comments? Go to <a href="http://{{ url_discussion_group }}">{{ url_discussion_group }}</a>
			or email <a href="mailto:{{ email_discussion_group }}">{{ email_discussion_group }}</a>
		</div>
		<div class="break">
			Please report bugs or suggest improvements at <a href="http:/{{ url_issues_page }}">{{ url_issues_page }}</a>
		</div>
		<div class="break">
			Source code for this project is at <a href="http://{{ url_source_code }}">{{ url_source_code }}</a>
		</div>
        <div class="break">
            {{ app_title }} uses cookies for two purposes;
            <ul>
                <li>To track your authorisation credentials between pages. This ensure that you (and only you) can get the results of your backup request.</li>
                <li><a href="http://www.google.com/analytics/">Google Analytics</a> is used to track usage such as; number of unique visitors, location, browser type, operating system. </li>
            </ul>
        </div>
	</div>

</body>
</html>
